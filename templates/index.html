{% extends "base.html" %}
{% block title %}–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞{% endblock %}

{% block left %}
<h5 class="mb-3">üìã –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h5>
<div class="row">
    <div class="col-md-12">
        <form action="/start" method="get">
            <button type="submit" class="btn btn-primary w-100">‚ñ∂Ô∏è Start</button>
        </form>
    </div>
    <div class="col-md-5">
        <span class="badge bg-success me-2">–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: {{ sent or 0 }}</span>
        <span class="badge bg-warning text-dark">–û–∂–∏–¥–∞–µ—Ç: {{ pending or 0 }}</span>
    </div>
    <div class="col-md-7">
        {% if message %}
        <p class="text-info m-0" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
            {{ message }}
        </p>
        {% endif %}
        {% if error %}
        <p class="text-danger m-0">–û—à–∏–±–∫–∞: {{ error }}</p>
        {% endif %}
    </div>
</div>

<div class="row">
    <div class="col-md-5">
        <div class="row">
            <div class="col-md-12">
                <p class="m-0">–°–æ–æ–±—â–µ–Ω–∏–µ:</p>
            </div>
            <div class="col-md-5 border rounded ms-2 p-1 text-center">
                {% if image_directory_path %}
                <img src="{{ image_directory_path }}" class="img-fluid" alt="–ö–∞—Ä—Ç–∏–Ω–∫–∞">
                {% else %}
                <p>–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.</p>
                {% endif %}

                {% if sent_message %}
                <p class="text-success small m-0">
                    {{ sent_message[:10] ~ '...' if sent_message|length > 10 else sent_message }}
                </p>
                {% endif %}
            </div>
            <div class="col-md-6">
                <p class="m-0">–ó–¥–µ—Å—å –Ω—É–∂–Ω–æ —á—Ç–æ-—Ç–æ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏ (–º–∞–∫—Å–∏–º—É–º 1000 —Å–∏–º–≤–æ–ª–æ–≤).</p>
            </div>
        </div>
    </div>
    <div class="col-md-7">
        <form action="/reset_statuses" method="get" class="mb-1">
            <button type="submit" class="btn btn-danger w-100">üîÑ –°–±—Ä–æ—Å–∏—Ç—å —Å—Ç–∞—Ç—É—Å—ã</button>
        </form>
    </div>
</div>


{% endblock %}

{% block right %}
<h5 class="mb-3">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h5>

<form action="/upload" method="post" enctype="multipart/form-data" class="mb-2">
    <label class="form-label">üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</label>
    <div class="input-group">
        <input type="file" name="file" class="form-control" required>
        <button type="submit" class="btn btn-success">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
    </div>
</form>

<form action="/text" method="post" class="mb-2">
    <label class="form-label">üí¨ –í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ</label>
    <div class="input-group">
        <input type="text" name="text" class="form-control" required>
        <button type="submit" class="btn btn-success">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
    </div>
</form>

<p>!–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–º–µ—Ä–∞!</p>

<form action="/" method="post" id="categoryForm">
    <label for="categorySelect" class="form-label">üìÇ&nbsp;–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
    <select name="category" id="categorySelect" class="form-select" required
        onchange="document.getElementById('categoryForm').submit()">
        <option value="" disabled {% if not selected_category %}selected{% endif %}>-- –í—ã–±–µ—Ä–∏—Ç–µ --</option>
        {% for cat in categories %}
        <option value="{{ cat }}" {% if cat==selected_category %}selected{% endif %}>{{ cat }}</option>
        {% endfor %}
    </select>
</form>
<div class="mt-2">
    <span class="badge bg-info">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: {{ length }}</span>
</div>

{% endblock %}

{% block picture %}
<div class="mb-4">
    {% if current_image_url %}
    <img src="{{ current_image_url }}" class="img-thumbnail fixed-size-img" alt="–ö–∞—Ä—Ç–∏–Ω–∫–∞">
    {% else %}
    <p>–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.</p>
    {% endif %}
</div>

<div class="d-flex justify-content-center gap-2 mt-2">
    <form action="/next" method="get">
        <button type="submit" class="btn btn-outline-primary">–°–ª–µ–¥—É—é—â–µ–µ</button>
    </form>
    <form action="/save_image" method="post">
        <button type="submit" class="btn btn-outline-success">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </form>
    <form action="/delete_image" method="post">
        <input type="hidden" name="image_url_id" value="{{ current_image_url }}">
        <button type="submit" class="btn btn-outline-danger">–£–¥–∞–ª–∏—Ç—å</button>
    </form>
</div>
{% endblock %}

{% block phone %}
{% if numbers %}
<h6 class="mt-2">üì± –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –Ω–æ–º–µ—Ä–∞:</h6>
<ol class="list-group list-group-numbered scrollable-list flex-grow-1">
    {% for contact in numbers %}
    <li class="list-group-item small d-flex align-items-center justify-content-between">
        <div>
            {% if contact.status == "sent" %}
            ‚úÖ
            {% elif contact.status == "pending" %}
            ‚è≥
            {% elif contact.status == "error" %}
            ‚ùå
            {% else %}
            ‚ùî
            {% endif %}
            {{ contact.name or "–ë–µ–∑ –∏–º–µ–Ω–∏" }} ‚Äî {{ contact.number }}
        </div>
        <div class="btn-group btn-group-sm" role="group">
            <form action="/change_status" method="post" class="d-inline">
                <input type="hidden" name="phone" value="{{ contact.number }}">
                <input type="hidden" name="status" value="sent">
                <button type="submit" class="btn btn-success" title="–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ">‚úÖ</button>
            </form>
            <form action="/change_status" method="post" class="d-inline">
                <input type="hidden" name="phone" value="{{ contact.number }}">
                <input type="hidden" name="status" value="pending">
                <button type="submit" class="btn btn-warning" title="–û–∂–∏–¥–∞–µ—Ç">‚è≥</button>
            </form>
            <form action="/delete_number" method="post" class="d-inline">
                <input type="hidden" name="phone" value="{{ contact.number }}">
                <button type="submit" class="btn btn-outline-danger" title="–£–¥–∞–ª–∏—Ç—å">üóë</button>
            </form>
        </div>
    </li>
    {% endfor %}
</ol>
{% endif %}
{% endblock %}